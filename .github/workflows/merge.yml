name: 自动合并代码

on:
  schedule:
    - cron: '*/10 * * * *'  # 每10分钟运行一次
  workflow_dispatch:  # 手动运行按钮

jobs:
  merge:
    runs-on: ubuntu-latest
    steps:
      - name: 下载仓库代码
        uses: actions/checkout@v4
        
      - name: 下载第一个页面
        run: |
          curl -s -o page1.html https://raw.githubusercontent.com/mytv-android/BRTV-Live-M3U8/refs/heads/main/iptv.m3u
          
      - name: 下载第二个页面  
        run: |
          curl -s -o page2.html https://raw.githubusercontent.com/liniani/BRTV-Live-M3U8/refs/heads/main/cctv.m3u
          
      - name: 合并文件
        run: |
          echo "合并时间: $(date)" > 2026IPTV.m3u
          echo "<h1>第一个页面</h1>" >> 2026IPTV.m3u
          cat page1.html >> 2026IPTV.m3u
          echo "<h1>第二个页面</h1>" >> 2026IPTV.m3u 
          cat page2.html >> 2026IPTV.m3u
          
      - name: 上传到仓库
        run: |
          git config --global user.name '自动合并机器人'
          git config --global user.email '机器人@github.com'
          git add 合并结果.html
          git commit -m "自动合并 $(date '+%Y-%m-%d %H:%M')" || echo "没有变化"
          git push
